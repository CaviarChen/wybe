# Compiler for the Wybe language

## How to build

```
make
```
OR
```
stack build
stack exec wybemk
```

## Code structure

File               | Purpose
-------------------|----------
wybemk.hs          | Wybe compiler/builder main code
wybelibs/wybe.wybe | The Wybe standard library (built-ins)
Options.hs         | Handle compiler options/switches
Config.hs          | Configuration for wybe compiler
Util.hs            | Various small utility functions
AST.hs             | Types and functions for the abstract syntax tree
Types.hs           | Type checker/inferencer for Wybe
BinaryFactory.hs   | Deriving AST Types to be Binary instances
Emit.hs            |
Snippets.hs        | Convenience functions for generation of Wybe AST
Unbranch.hs        | Turn loops and conditionals into separate procedures
Builder.hs         | Handles compilation at the module level
Scanner.hs         | Scanner for the Wybe language
NewParser.hs       |
Flatten.hs         | Flatten function calls (expressions) into procedure calls
Normalise.hs       | Convert parse tree into AST
Resources.hs       | Resource checker/transformer for Wybe
Clause.hs          | Convert Wybe code to clausal (LPVM) form
Blocks.hs          | Transform a clausal form (LPVM) module to LLVM
Codegen.hs         | Generate and emit LLVM from basic blocks of a module
Callers.hs         | Find all callers for each proc & count static calls per caller
DefUse.hs          | Compute defined and used variables for statements and exprs
BodyBuilder.hs     | A monad to build up a procedure Body, with copy propagation
Expansion.hs       | Replace certain procedure calls with others
LastUse.hs         | Mark last use of each variable and remove unneeded parameters
Optimise.hs        | Framework to optimise a single module
Macho.hs           |
ObjectInterface.hs | Parse and edit a object file
Test.hs            |
cbits.c            |
test-cases         | Directory of test cases and the code they should generate
ERRS               | Generated by make showing errors at last compiler test
INSTALL            |
ISSUES             | Obsolete document considering language design issues
Makefile           | builds and tests the compiler
TODO               | Work needed on the compiler
stack.yaml         |
update-exp         |
wybe.cabal         |

| **Obsolete** |           |
|--------------|-----------|
nondet         |
nondet.pl      |
parser.pl      | Initial work on designing a new syntax
Parser.y       | Parser for the Wybe language
basicchar.wybe |
list.wybe      |
sequence.wybe  |
Wybe.planner   |
wybe.old       |

| **Documentations**       |           |
|--------------------------|-----------|
documentation/compiler.tex |
documentation/design.tex   | Very old language design document, in need of updating
documentation/redesign.tex | Slightly out of date paper on the current language design
documentation/wybe.tex     | Slides for a introductory talk on Wybe; somehwat out of date
publications/              | Some talks about wybe and frege (its predecessor)