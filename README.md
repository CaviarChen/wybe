# Compiler for the Wybe language

## How to build

```shell
make
```

OR

```shell
stack build
stack exec wybemk
```

## Code structure

Source code            | Purpose
-----------------------|----------
wybelibs/wybe.wybe     | The Wybe standard library (built-ins)
src/wybemk.hs          | Wybe compiler/builder main code
src/Options.hs         | Handle compiler options/switches
src/Config.hs          | Configuration for wybe compiler
src/Util.hs            | Various small utility functions
src/AST.hs             | Types and functions for the abstract syntax tree
src/Types.hs           | Type checker/inferencer for Wybe
src/BinaryFactory.hs   | Deriving AST Types to be Binary instances
src/Emit.hs            |
src/Snippets.hs        | Convenience functions for generation of Wybe AST
src/Unbranch.hs        | Turn loops and conditionals into separate procedures
src/Builder.hs         | Handles compilation at the module level
src/Scanner.hs         | Scanner for the Wybe language
src/NewParser.hs       |
src/Flatten.hs         | Flatten function calls (expressions) into procedure calls
src/Normalise.hs       | Convert parse tree into AST
src/Resources.hs       | Resource checker/transformer for Wybe
src/Clause.hs          | Convert Wybe code to clausal (LPVM) form
src/Blocks.hs          | Transform a clausal form (LPVM) module to LLVM
src/Codegen.hs         | Generate and emit LLVM from basic blocks of a module
src/Callers.hs         | Find all callers for each proc & count static calls per caller
src/DefUse.hs          | Compute defined and used variables for statements and exprs
src/BodyBuilder.hs     | A monad to build up a procedure Body, with copy propagation
src/Expansion.hs       | Replace certain procedure calls with others
src/Optimise.hs        | Framework to optimise a single module
src/Macho.hs           |
src/ObjectInterface.hs | Parse and edit a object file

Other files in root    | Purpose
-----------------------|----------
Test.hs                |
cbits.c                |
test-cases/            | Directory of test cases and the code they should generate
ERRS                   | Generated by make showing errors at last compiler test
INSTALL                |
ISSUES                 | Obsolete document considering language design issues
Makefile               | builds and tests the compiler
TODO                   | Work needed on the compiler
stack.yaml             | stack configuration file
update-exp             | update expected outputs of test cases to match actual ones, if appropriate
wybe.cabal             |

| speculative/ | intend to implement these in future |
|--------------|-------------------------------------|
basicchar.wybe |
list.wybe      |
nondet         |
nondet.pl      |
sequence.wybe  |

| legacy/old-parser/ |           |
|--------------------|-----------|
lex.pl               |
Parser.hs            |
parser.pl            |

| **Documentations**       |           |
|--------------------------|-----------|
documentation/compiler.tex |
documentation/design.tex   | Very old language design document, in need of updating
documentation/redesign.tex | Slightly out of date paper on the current language design
documentation/wybe.tex     | Slides for a introductory talk on Wybe; somehwat out of date
publications/              | Some talks about wybe and frege (its predecessor)