# shouldn't alias to the data structure if all properties mutated in the proc
# the destructive update flags are correct?
# wait for LLVM code generation to finish?

use position

public proc replicate1(p1:position, ?p2:position) use !io
  ?pp = position(0,0)
  !print("random replicate1")
  !println(pp.x)
  ?p2 = p1
  x(!p2, 2)
  y(!p2, 2)
end

public proc bar use !io
  ?p1 = position(1,1)
  !replicate1(p1, ?p2)

  x(!p1, 555)
  !print("p1.x")
  !println(p1.x) # expected 555 - is 555
  !print("p1.y")
  !println(p1.y) # expected 1 - is 2
  !print("p2.x")
  !println(p2.x) # expected 2 - is 555
  !print("p2.y")
  !println(p2.y) # expected 2 - is 2
end

!bar