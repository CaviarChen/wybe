# partial data structures aliasing in nested proc calls

use data_structure.position

public proc replicate1(pa:position, ?pb:position, ?pc:position) use !io
    ?pb = pa
    ?pc = pa

    ?pp = position(99,99)
    x(!pb, pp.x)
end

public proc replicate21(?pb:position) use !io
    ?pa = position(99999,99999)
    ?pb = pa
    ?pc = pa
    x(!pc, 1111111111)
    !println("replicate21: ")
    !println(pc.x)
end

public proc replicate22(?pb:position, ?pc:position) use !io
    ?pa = position(99999,99999)
    ?pb = pa
    ?pc = pa
    !println("replicate22: ")
    !println(pc.x)

    x(!pc, 1111111111)
end

?p1 = position(10,10)
!replicate1(p1, ?p2, ?p3)

!print("expect p1 is 10? ")
!println(p1.x)

!print("expect p2 is 99? ")
!println(p2.x)

!print("expect p3 is 10? ")
!println(p3.x)



# pb and pc is aliased
!print("????? ")
!replicate21(?p4, ?p5)
!println(p4.x)
!println(p5.x)
!replicate22(?p6, ?p7)
!println(p6.x)
!println(p7.x)